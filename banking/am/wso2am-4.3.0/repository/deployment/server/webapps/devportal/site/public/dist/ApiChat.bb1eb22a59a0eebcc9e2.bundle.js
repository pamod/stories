"use strict";(this.webpackChunk_wso2apim_devportal=this.webpackChunk_wso2apim_devportal||[]).push([[6792],{625688:(e,t,n)=>{n.r(t),n.d(t,{default:()=>De});var a=n(811504),r=n(991568),i=n(715656),s=n(906940),o=n(47568),c=n(209176),l=n(70132),d=n(404292),p=n(286572),u=n(570440),m=n(964408),g=n(273384),h=n(458130),f=n(162248),y=n(33964),x=n(669872),A=n(617624),C=n(902706),b=n(385388),E=n(452904),v=n(106220);const j=({openConfigureKey:e,goBack:t,disableGoBack:n,disableConfigureKey:a})=>(0,A.jsxs)(r.c,{display:"flex",width:"100%",m:3,children:[(0,A.jsxs)(r.c,{display:"flex",flexDirection:"column",flexGrow:1,children:[(0,A.jsxs)(r.c,{display:"flex",children:[(0,A.jsx)(f.c,{id:"itest-api-details-api-chat-title",variant:"h3",component:"h3",children:(0,A.jsx)(d.c,{id:"Apis.Details.ApiChat.components.ApiChatPoweredBy.apiChatMainHeader",defaultMessage:"API Chat"})}),(0,A.jsx)(b.c,{label:"Experimental",variant:"outlined",size:"small",color:"primary",sx:{ml:1}})]}),(0,A.jsx)(f.c,{variant:"body2",color:"textSecondary",component:"p",children:(0,A.jsx)(d.c,{id:"Apis.Details.ApiChat.components.ApiChatPoweredBy.poweredByText",defaultMessage:"Powered by Azure OpenAI"})})]}),(0,A.jsx)(r.c,{children:(0,A.jsxs)(r.c,{display:"flex",pr:4,children:[(0,A.jsx)(r.c,{mr:3,children:(0,A.jsx)(C.c,{startIcon:(0,A.jsx)(E.c,{}),id:"go-back",variant:"text",size:"small",onClick:t,disabled:n,children:(0,A.jsx)(d.c,{id:"Apis.Details.ApiChat.components.ApiChatPoweredBy.goBack",defaultMessage:"Go Back"})})}),(0,A.jsx)(r.c,{children:(0,A.jsx)(C.c,{startIcon:(0,A.jsx)(v.c,{}),id:"view-sample-queries",variant:"text",size:"small",onClick:e,disabled:a,children:(0,A.jsx)(d.c,{id:"Apis.Details.ApiChat.components.ApiChatPoweredBy.configureKey",defaultMessage:"Configure Key"})})})]})})]});var I=n(219811);const O="ApiChatBanner",T={tryAiBannerCont:`${O}-tryAiBannerCont`,tryAiBannerImgWrap:`${O}-tryAiBannerImgWrap`,tryAiBannerContentWrap:`${O}-tryAiBannerContentWrap`,tryAiBannerContent:`${O}-tryAiBannerContent`,tryAiBannerTriangle:`${O}-tryAiBannerTriangle`},w=(0,s.cp)("div")((({theme:e})=>({[`& .${T.tryAiBannerCont}`]:{display:"flex",paddingLeft:e.spacing(1),gridGap:e.spacing(1.5),maxWidth:e.spacing(85)},[`& .${T.tryAiBannerImgWrap}`]:{flex:`0 0 ${e.spacing(15)}px`,maxWidth:e.spacing(15),fontSize:e.spacing(15),display:"flex",alignItems:"center"},[`& .${T.tryAiBannerContentWrap}`]:{flexGrow:1,display:"flex",alignItems:"center"},[`& .${T.tryAiBannerContent}`]:{background:e.palette.grey[100],padding:e.spacing(2),borderRadius:e.spacing(0,2,2,2),position:"relative"},[`& .${T.tryAiBannerTriangle}`]:{position:"absolute",width:e.spacing(3),height:e.spacing(3),top:0,left:e.spacing(-3),overflow:"hidden","&:before":{content:'""',display:"block",width:"200%",height:"200%",position:"absolute",borderRadius:"50%",top:0,right:0,boxShadow:`${e.spacing(2.5)} ${e.spacing(-3.75)} 0 0 ${e.palette.grey[100]}`}}}))),k=()=>{const e=(0,l.c)();return(0,A.jsx)(w,{children:(0,A.jsxs)(r.c,{className:T.tryAiBannerCont,children:[(0,A.jsx)(r.c,{className:T.tryAiBannerImgWrap,children:(0,A.jsx)("img",{alt:"API Chat",src:`${I.app.context}/site/public/images/ai/ApiChat.svg`})}),(0,A.jsx)(r.c,{className:T.tryAiBannerContentWrap,children:(0,A.jsxs)(r.c,{className:T.tryAiBannerContent,children:[(0,A.jsx)(r.c,{className:T.tryAiBannerTriangle}),(0,A.jsx)(f.c,{variant:"h5",children:e.formatMessage({id:"Apis.Details.ApiChat.components.ApiChatBanner.apiChatMainTextHeader",defaultMessage:"Your API is now equipped with an Intelligent Agent!"})}),(0,A.jsx)(f.c,{variant:"caption",children:e.formatMessage({id:"Apis.Details.ApiChat.components.ApiChatBanner.apiChatMainTextContent",defaultMessage:"Effortlessly test your APIs in natural language with our API Chat Agent powered by Azure OpenAI's cutting-edge language models."})})]})})]})})};var M=n(449784),S=n(6060),D=n(206976),P=n(714971),$=n(367728);const B=["label","width","readOnly","error","helperText","rows","multiline","optional","loading","tooltip","inputTooltip","size","info","actions","testId","variant","rounded","resizeIndicator"];function R(){return R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},R.apply(this,arguments)}const N="TextInput",L={root:`${N}-root`,rootSmall:`${N}-rootSmall`,rootLarge:`${N}-rootLarge`,readOnlyDefault:`${N}-readOnlyDefault`,readOnlyPlain:`${N}-readOnlyPlain`,rounded:`${N}-rounded`,focused:`${N}-focused`,error:`${N}-error`,textInput:`${N}-textInput`,textInputLarge:`${N}-textInputLarge`,inputAdornedEnd:`${N}-inputAdornedEnd`,inputAdornedEndAlignTop:`${N}-inputAdornedEndAlignTop`,textarea:`${N}-textarea`,inputGroup:`${N}-inputGroup`},q=(0,s.cp)("div")((e=>{let{theme:t}=e;return{[`& .${L.root}`]:{padding:t.spacing(1.5,1.5),width:"100%",minHeight:t.spacing(5),backgroundColor:t.palette.common.white,border:`1px solid ${(0,$.W4)(t.palette.primary.main,.5)}`,borderRadius:5,"&$multiline":{height:"auto",resize:"auto"},"&$multilineReadonly":{height:"auto",resize:"none","& $textarea":{height:"auto",resize:"none"}},"&$multilineResizeIndicator":{height:"auto",resize:"none","& $textarea":{height:"auto",resize:"none"}},"&$rounded":{paddingLeft:t.spacing(2)},"&:hover":{borderColor:`${(0,$.W4)(t.palette.primary.main,.5)}`}},[`& .${L.rootSmall}`]:{minHeight:t.spacing(4)},[`& .${L.rootLarge}`]:{minHeight:t.spacing(7),borderRadius:12,padding:t.spacing(1,1,1,3)},[`& .${L.readOnlyDefault}`]:{boxShadow:`0 0 0 1px ${(0,$.W4)(t.palette.common.black,.05)}, inset 0 2px 2px ${(0,$.W4)(t.palette.common.black,.05)}`,border:"none",backgroundColor:t.palette.secondary.light},[`& .${L.readOnlyPlain}`]:{boxShadow:"none",border:"none",backgroundColor:t.palette.common.white,paddingLeft:0,paddingRight:0},[`& .${L.rounded}`]:{borderRadius:t.spacing(2.5)},[`& .${L.focused}`]:{borderColor:t.palette.primary.light,borderWidth:1},[`& .${L.error}`]:{background:t.palette.error.light,borderColor:t.palette.error.main,boxShadow:`0 0 0 1px ${t.palette.error.light}, inset 0 2px 2px ${(0,$.W4)(t.palette.error.light,.07)}`,"&:hover":{borderColor:t.palette.error.main}},[`& .${L.textInput}`]:{minHeight:t.spacing(2.5),padding:t.spacing(.125,0),fontSize:t.typography.body1.fontSize,fontWeight:t.typography.body1.fontWeight,lineHeight:t.typography.body1.lineHeight},[`& .${L.textInputLarge}`]:{fontSize:t.typography.overline.fontSize,fontWeight:t.typography.overline.fontWeight,lineHeight:t.typography.overline.lineHeight},[`& .${L.inputAdornedEnd}`]:{"& .MuiInputAdornment-root":{marginRight:t.spacing(-1)}},[`& .${L.inputAdornedEndAlignTop}`]:{"& .MuiInputAdornment-root":{alignSelf:"flex-end",height:"auto",marginBottom:t.spacing(.25)}},[`& .${L.textarea}`]:{resize:"both"},[`& .${L.inputGroup}`]:{position:"relative"}}})),W=(e,t)=>{const{label:n,width:i,readOnly:s,error:o,helperText:c,rows:l,multiline:d,optional:p,loading:u,tooltip:m,inputTooltip:g,size:h="medium",info:y,actions:x,testId:A,variant:C="default",rounded:b=!1,resizeIndicator:E=!0}=e,v=function(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,B);return a.createElement(q,null,a.createElement(r.c,{width:i},a.createElement(r.c,{className:L.inputGroup},a.createElement(D.cp,R({ref:t,classes:{root:(0,P.default)({[L.root]:!0,[L.rootSmall]:"small"===h,[L.rootLarge]:"large"===h,[L.readOnlyDefault]:s&&"default"===C,[L.readOnlyPlain]:s&&"plain"===C,[L.multiline]:d,[L.multilineReadonly]:d&&s,[L.multilineResizeIndicator]:d&&!E,[L.rounded]:b}),focused:L.focused,error:L.error,inputMultiline:L.textarea,input:(0,P.default)({[L.textInput]:!0,[L.textInputLarge]:"large"===h}),adornedEnd:(0,P.default)({[L.inputAdornedEnd]:!0,[L.inputAdornedEndAlignTop]:d})},readOnly:s},v,{error:o,rows:l,multiline:d,"data-cyid":A}))),c&&a.createElement(r.c,{display:"flex",alignItems:"center",ml:1},a.createElement(f.c,{variant:"body2",component:"p"},c))))},z=(0,a.forwardRef)(W),U="ApiChatExecute",K={tryAiBottom:`${U}-tryAiBottom`,tryAiBottomInner:`${U}-tryAiBottomInner`,reExecuteWrap:`${U}-reExecuteWrap`,tryAiBottomTextInputWrap:`${U}-tryAiBottomTextInputWrap`,disclaimerText:`${U}-disclaimerText`},_=(0,S.c)("div")((({theme:e})=>({[`& .${K.tryAiBottom}`]:{position:"sticky",left:0,right:0,marginLeft:e.spacing(-1),marginRight:e.spacing(-1)},[`& .${K.tryAiBottomInner}`]:{padding:e.spacing(3,1)},[`& .${K.reExecuteWrap}`]:{marginTop:e.spacing(2),marginBottom:e.spacing(2),display:"flex",alignItems:"center",justifyContent:"center"},[`& .${K.tryAiBottomTextInputWrap}`]:{maxWidth:"100%",overflow:"hidden"},[`& .${K.disclaimerText}`]:{display:"flex",alignItems:"center",justifyContent:"center"}}))),H=(0,S.c)(M.c)({transform:"rotate(-40deg)",marginBottom:"5px"}),Q=({isAgentRunning:e,isAgentTerminating:t,lastQuery:n,handleStopAndReExecute:a,inputQuery:i,handleQueryChange:s,isEnrichingSpec:o,specEnrichmentError:c,handleExecute:p,isExecuteDisabled:u})=>{const m=(0,l.c)();return(0,A.jsx)(_,{children:(0,A.jsx)(r.c,{className:K.tryAiBottom,children:(0,A.jsxs)(r.c,{className:K.tryAiBottomInner,children:[(e||n)&&(0,A.jsx)(r.c,{className:K.reExecuteWrap,children:(0,A.jsx)(C.c,{variant:"outlined",onClick:a,id:"stop-reexecute-button",disabled:""!==c||t,children:e?(0,A.jsx)(d.c,{id:"Apis.Details.ApiChat.components.ApiChatExecute.stopButton.label",defaultMessage:"Stop Execution"}):(0,A.jsx)(d.c,{id:"Apis.Details.ApiChat.components.ApiChatExecute.rexecuteButton.label",defaultMessage:"Re-execute"})})}),(0,A.jsxs)(r.c,{className:K.tryAiBottomTextInputWrap,pl:2,children:[(0,A.jsx)(z,{fullWidth:!0,name:"query",value:i,placeholder:m.formatMessage({id:"Apis.Details.ApiChat.components.ApiChatExecute.queryInput.placeholder",defaultMessage:"Type the test scenario here..."}),onChange:s,testId:"nl-query-input",disabled:e||o||""!==c||u,multiline:!0,sx:{"& .TextInput-textarea":{resize:"none"}},resizeIndicator:!1,onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),p())},endAdornment:(0,A.jsx)(C.c,{variant:"contained",color:"primary",onClick:p,id:"run-agent-button",startIcon:(0,A.jsx)(H,{}),sx:{marginLeft:1},children:(0,A.jsx)(d.c,{id:"Apis.Details.ApiChat.components.ApiChatExecute.executeButton.label",defaultMessage:"Execute"})}),inputProps:{maxLength:500}}),(0,A.jsx)(r.c,{display:"flex",justifyContent:"flex-end",mt:1,mr:2,children:(0,A.jsxs)(f.c,{variant:"caption",children:[i.length,"/",500]})}),(0,A.jsx)(r.c,{className:K.disclaimerText,children:(0,A.jsx)(f.c,{variant:"body2",color:"textSecondary",component:"p",children:m.formatMessage({id:"Apis.Details.ApiChat.components.ApiChatExecute.disclaimer.label",defaultMessage:"It is prudent to exercise a degree of caution and thoughtfulness, as language models may exhibit some degree of unpredictability at times."})})})]})]})})})};var G=n(203268),Y=n(808696),F=n(924004),V=n(929232),J=n(403972),X=n(915176),Z=n(695312),ee=n(96144),te=n(356024);const ne=e=>{let{isDrawerOpen:t,updateDrawerOpen:n,setTestAccessToken:s,onConfigChange:c}=e;const[l,p]=(0,a.useState)(null),[u,m]=(0,a.useState)("OAUTH"),[g,h]=(0,a.useState)(""),[y,A]=(0,a.useState)(""),[b,E]=(0,a.useState)([]),[v,j]=(0,a.useState)("PRODUCTION"),[I,O]=(0,a.useState)([]),[T,w]=(0,a.useState)(""),[k,M]=(0,a.useState)(""),[S,D]=(0,a.useState)(""),[P,$]=(0,a.useState)([]),[B,R]=(0,a.useState)("Resident Key Manager"),[N,L]=(0,a.useState)(""),[q,W]=(0,a.useState)(""),[z,U]=(0,a.useState)("Authorization"),[K,_]=(0,a.useState)(""),[H,Q]=(0,a.useState)("PRODUCTION"),G=x.c.getUser(),{api:ne}=(0,a.useContext)(o.U);return(0,a.useEffect)((()=>{p(ne)}),[ne]),(0,a.useEffect)((()=>{if(l){if(l.endpointURLs&&$(l.endpointURLs.map((e=>({name:e.environmentName,displayName:e.environmentDisplayName})))),l.scopes){const e=l.scopes.map((e=>e.key));E(e)}let e="OAUTH";l.securityScheme.includes("oauth2")||(e=l.securityScheme.includes("api_key")?"API-KEY":"BASIC"),P&&P.length>0&&w(P[0].name),M(k),D(S),m(e)}}),[l]),(0,a.useEffect)((()=>{l&&P&&P.length>0&&w(P[0].name)}),[P,l]),(0,a.useEffect)((()=>{n(t)}),[t]),null==l?a.createElement(J.c,null):a.createElement(a.Fragment,null,a.createElement(Y.cp,{title:"Configure Key",anchor:"right",open:t,onClose:()=>n(!1),id:"api-chat-configure-key-drawer",PaperProps:{sx:{width:"70%",borderRadius:1}}},a.createElement(r.c,{p:2},a.createElement(i.cp,{container:!0,justifyContent:"space-between",alignItems:"center"},a.createElement(i.cp,{item:!0,xs:10},a.createElement(f.c,{variant:"h6"},a.createElement(d.c,{id:"Apis.Details.ApiChat.components.ConfigureKeyDrawer.title",defaultMessage:"Configure Key"}))),a.createElement(i.cp,{item:!0,xs:2,display:"flex",justifyContent:"flex-end"},a.createElement(ee.c,{onClick:()=>n(!1),size:"large"},a.createElement(te.c,null)))),a.createElement(i.cp,{container:!0,padding:2},!G&&(!l.advertiseInfo||!l.advertiseInfo.advertised)&&a.createElement(F.c,{sx:{padding:1}},a.createElement(f.c,{variant:"h5",component:"h3"},a.createElement(V.c,{sx:{verticalAlign:"middle",marginBottom:.5}})," ",a.createElement(d.c,{id:"notice",defaultMessage:"Notice"})),a.createElement(f.c,{component:"p",align:"justify",sx:{padding:1}},a.createElement(d.c,{id:"api.console.require.access.token",defaultMessage:"You need an access token to try the API. Please log in and subscribe to the API to generate an access token. If you already have an access token, please provide it below."})))),a.createElement(i.cp,{container:!0,justifyContent:"center",spacing:0},a.createElement(X.c,{setSecurityScheme:m,securitySchemeType:u,setSelectedEnvironment:w,selectedEnvironment:T,productionAccessToken:k,setProductionAccessToken:M,sandboxAccessToken:S,setSandboxAccessToken:D,environments:P,scopes:b,setUsername:h,setPassword:A,username:g,password:y,setSelectedKeyType:j,selectedKeyType:v,setSelectedKeyManager:(e,t,n)=>{t?(R(e),(e=>{let t;I.get(B)&&I.get(B).keyType===v?(({accessToken:t}=I.get(B).token),"PRODUCTION"===v?M(t):D(t)):Z.c.get(e).then((e=>e.getKeys(v))).then((e=>{e.get(B)&&e.get(B).keyType===v&&({accessToken:t}=e.get(B).token),"PRODUCTION"===e.get(B).keyType?M(t):D(t),O(e)}))})(n)):R(e)},selectedKeyManager:B,setKeys:O,setProductionApiKey:L,setSandboxApiKey:W,productionApiKey:N,sandboxApiKey:q,setAdvAuthHeader:U,setAdvAuthHeaderValue:_,advAuthHeader:z,advAuthHeaderValue:K,setSelectedEndpoint:Q,selectedEndpoint:H,api:l,URLs:null,autoGenerateToken:!0,setTestAccessToken:s,onConfigChange:c})),a.createElement(i.cp,{container:!0,justifyContent:"right",pr:2},a.createElement(C.c,{variant:"outlined",type:"submit",color:"primary","data-testid":"key-details-cancel",onClick:()=>n(!1),sx:{marginRight:"1em"}},a.createElement(d.c,{id:"Apis.Details.ApiChat.components.ConfigureKeyDrawer.cancel",defaultMessage:"Cancel"})),a.createElement(C.c,{variant:"contained",type:"submit",color:"primary","data-testid":"key-details-save",onClick:()=>n(!1)},a.createElement(d.c,{id:"Apis.Details.ApiChat.components.ConfigureKeyDrawer.done",defaultMessage:"Done"}))))))};ne.propTypes={isDrawerOpen:G.PropTypes.bool.isRequired,updateDrawerOpen:G.PropTypes.func.isRequired,setTestAccessToken:G.PropTypes.func.isRequired,onConfigChange:G.PropTypes.func.isRequired};const ae=ne;var re=n(677516),ie=n(614477),se=n(542112),oe=n(969072),ce=n(975048);const le="SampleQueryCard",de={sampleQuery:`${le}-sampleQuery`,sampleQueryCard:`${le}-SampleQueryCard`},pe=(0,s.cp)("div")((({theme:e})=>({[`& .${de.sampleQuery}`]:{maxHeight:"25px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},[`& .${de.sampleQueryCard}`]:{"&:hover":{backgroundColor:"transparent",border:`1px solid ${(0,$.W4)(e.palette.primary.main,.5)}`}}}))),ue=({onExecuteClick:e,queryData:t,onCopyClick:n,disabled:i})=>{const s=(0,l.c)(),o=s.formatMessage({id:"Apis.Details.ApiChat.components.CopyToClipboard.copyText",defaultMessage:"Copy to Clipboard"}),c=s.formatMessage({id:"Apis.Details.ApiChat.components.CopyToClipboard.copiedText",defaultMessage:"Copied"}),[d,p]=(0,a.useState)(o);return(0,A.jsx)(pe,{children:(0,A.jsx)(re.c,{className:de.sampleQueryCard,children:(0,A.jsx)(se.c,{disabled:i,onClick:()=>e(t.query),children:(0,A.jsx)(ie.c,{children:(0,A.jsxs)(r.c,{display:"flex",flexDirection:"column",height:1,children:[(0,A.jsxs)(r.c,{mb:2,children:[(0,A.jsx)(f.c,{variant:"body1",children:t.scenario}),(0,A.jsx)(f.c,{variant:"body2",color:"textSecondary",component:"p",className:de.sampleQuery,children:t.query})]}),(0,A.jsx)(r.c,{mt:"auto",children:(0,A.jsxs)(r.c,{children:[(0,A.jsx)(C.c,{size:"small",id:"sample-query-execute",variant:"outlined",disabled:i,onClick:n=>{e(t.query),n.stopPropagation()},children:s.formatMessage({id:"Apis.Details.ApiChat.components.SampleQueryCard.executeButton",defaultMessage:"Execute"})}),(0,A.jsx)(oe.c,{title:d,onClose:()=>{p(o)},placement:"top-end",children:(0,A.jsx)(ee.c,{id:"sample-query-copy",size:"small",onClick:e=>{var a;a=t.query,p(c),n(a),e.stopPropagation()},sx:{ml:1},children:(0,A.jsx)(ce.c,{fontSize:"inherit"})})})]})})]})})})})})};var me=n(244400),ge=n(861562),he=n(79592),fe=n(834508),ye=n(486280),xe=n(304632),Ae=n(569024),Ce=n(870208),be=n(27085),Ee=n.n(be),ve=n(602640);const je="ApiChatResponse",Ie={finalOutcomeContent:`${je}-finalOutcomeContent`,lastQueryWrap:`${je}-lastQueryWrap`,queryProcessLoader:`${je}-queryProcessLoader`,responseBannerContentWrap:`${je}-responseBannerContentWrap`,responseBannerContent:`${je}-responseBannerContent`,responseBannerTriangle:`${je}-responseBannerTriangle`,queryBannerTriangle:`${je}-queryBannerTriangle`,queryBannerContent:`${je}-queryBannerContent`,queryBannerContentWrap:`${je}-queryBannerContentWrap`},Oe=(0,s.cp)("div")((({theme:e})=>({[`& .${Ie.finalOutcomeContent}`]:{paddingTop:e.spacing(2),paddingBottom:e.spacing(2),textAlign:"justify"},[`& .${Ie.lastQueryWrap}`]:{margin:e.spacing(1,4)},[`& .${Ie.queryProcessLoader}`]:{marginTop:e.spacing(2),display:"flex",justifyContent:"center"},[`& .${Ie.responseBannerContentWrap}`]:{flexGrow:1,display:"flex",alignItems:"center"},[`& .${Ie.queryBannerContentWrap}`]:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"flex-end"},[`& .${Ie.responseBannerContent}`]:{width:"100%",background:e.palette.grey[100],padding:e.spacing(2),borderRadius:e.spacing(0,2,2,2),position:"relative"},[`& .${Ie.queryBannerContent}`]:{background:`${(0,$.W4)(e.palette.primary.main,.1)}`,padding:e.spacing(2),borderRadius:e.spacing(2,0,2,2),position:"relative"},[`& .${Ie.queryBannerTriangle}`]:{color:"red",position:"absolute",width:e.spacing(33),height:e.spacing(33),top:0,right:e.spacing(-2),overflow:"hidden","&:before":{content:'""',display:"block",width:"200%",height:"200%",position:"absolute",borderRadius:"50%",top:0,left:0}},[`& .${Ie.responseBannerTriangle}`]:{position:"absolute",width:e.spacing(3),height:e.spacing(3),top:0,left:e.spacing(-2),overflow:"hidden","&:before":{content:'""',display:"block",width:"200%",height:"200%",position:"absolute",borderRadius:"50%",top:0,right:0}}}))),Te=({lastQuery:e,executionResults:t,finalOutcome:n,isAgentRunning:s,isAgentTerminating:o,isExecutionError:c})=>{const[l,p]=(0,a.useState)("You");(0,a.useEffect)((()=>{const e=y.c.getUser();e&&p(e)}),[]);const u=e=>{const t=e.headers.get("Content-Type");if(t.includes("application/json")&&""!==e.body)return(0,A.jsx)(Ce.cp,{width:"100%",height:"200",language:"json",value:JSON.stringify(e.body,null,2),options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on"}});if(t.includes("application/xml")&&""!==e.body){const t=Ee()(e.body);return(0,A.jsx)(Ce.cp,{width:"100%",height:"200",language:"xml",value:t,options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on"}})}return(0,A.jsx)(f.c,{variant:"body1",children:e.body})};return(0,A.jsx)(Oe,{children:(0,A.jsx)(r.c,{maxHeight:"60%",overflow:"auto",className:Ie.lastQueryWrap,children:(0,A.jsxs)(F.c,{children:[(0,A.jsx)(i.cp,{justifyContent:"flex-end",container:!0,children:(0,A.jsx)(oe.c,{title:l.toUpperCase(),"aria-label":l.toUpperCase(),placement:"bottom",children:(0,A.jsx)(Ae.c,{fontSize:"large",sx:{color:"#10597f",marginRight:2}})})}),(0,A.jsx)(r.c,{className:Ie.queryBannerContentWrap,ml:6,mr:6,mt:-1,children:(0,A.jsxs)(r.c,{className:Ie.queryBannerContent,children:[(0,A.jsx)(r.c,{className:Ie.queryBannerTriangle}),(0,A.jsx)(f.c,{variant:"body1",align:"left",children:e})]})}),(0,A.jsx)(ve.c,{width:50,height:50,icon:"api-chat"}),(0,A.jsx)(r.c,{className:Ie.responseBannerContentWrap,ml:6,mr:6,mt:-2.5,children:(0,A.jsxs)(r.c,{className:Ie.responseBannerContent,children:[(0,A.jsx)(r.c,{className:Ie.responseBannerTriangle}),0!==t.length&&(0,A.jsx)(f.c,{variant:"body1",mb:2,children:(0,A.jsx)(d.c,{id:"Apis.Details.ApiChat.components.ApiChatResponse.executionResults",defaultMessage:"Certainly! Here are the results of the API calls I executed on your behalf:"})}),t.map((e=>(0,A.jsxs)(me.c,{children:[(0,A.jsx)(ge.c,{expandIcon:(0,A.jsx)(xe.c,{}),children:(0,A.jsxs)(A.Fragment,{children:[e.code>=200&&e.code<300?(0,A.jsx)(b.c,{icon:(0,A.jsx)(fe.c,{color:"success"}),label:e.code,color:"success",variant:"outlined",size:"small"}):(0,A.jsx)(b.c,{icon:(0,A.jsx)(ye.c,{color:"error"}),label:e.code,color:"error",variant:"outlined",size:"small"}),(0,A.jsx)(f.c,{variant:"body1",ml:2,sx:{alignContent:"center"},children:"Executed "+e.method+" "+e.path})]})}),(0,A.jsx)(he.c,{children:(0,A.jsx)(f.c,{variant:"body1",children:u(e)})})]}))),!s&&e&&n&&!c&&(0,A.jsx)(A.Fragment,{children:0===t.length?(0,A.jsx)(r.c,{display:"flex",children:(0,A.jsx)(f.c,{variant:"body1",children:n})}):(0,A.jsx)(r.c,{display:"flex",justifyContent:"center",className:Ie.finalOutcomeContent,children:(0,A.jsx)(f.c,{variant:"body1",children:n})})}),e&&!n&&(0,A.jsx)(A.Fragment,{children:(0,A.jsx)(r.c,{className:Ie.queryProcessLoader,children:o?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(h.c,{size:20}),(0,A.jsx)(f.c,{variant:"body1",sx:{paddingLeft:"5px"},children:(0,A.jsx)(d.c,{id:"Apis.Details.ApiChat.components.ApiChatResponse.terminatingMessage",defaultMessage:"Execution is terminating..."})})]}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(h.c,{size:20}),(0,A.jsx)(f.c,{variant:"body1",sx:{paddingLeft:"5px"},children:(0,A.jsx)(d.c,{id:"Apis.Details.ApiChat.components.ApiChatResponse.loadingMessage",defaultMessage:"Loading next execution step..."})})]})})})]})})]})})})};function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?we(Object(n),!0).forEach((function(t){var a,r,i,s;a=e,r=t,i=n[t],(r="symbol"==typeof(s=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r))?s:String(s))in a?Object.defineProperty(a,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[r]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Me="ApiChat-tryWithAiMain",Se=(0,s.cp)("div")((e=>{let{theme:t}=e;return{[`& .${Me}`]:{display:"flex",flexDirection:"column",minHeight:"85vh",marginRight:t.spacing(6),marginLeft:t.spacing(2)}}})),De=()=>{const[e,t]=(0,a.useState)(!1),[n,s]=(0,a.useState)(!1),[A,C]=(0,a.useState)(!1),[b,E]=(0,a.useState)(""),[v,I]=(0,a.useState)(""),[O,T]=(0,a.useState)({}),[w,M]=(0,a.useState)([]),[S,D]=(0,a.useState)(""),[P,$]=(0,a.useState)(""),[B,R]=(0,a.useState)(""),[N,L]=(0,a.useState)([]),[q,W]=(0,a.useState)(!1),[z,U]=(0,a.useState)(!1),[K,_]=(0,a.useState)(null),[H,G]=(0,a.useState)(null),[Y,F]=(0,a.useState)(null),[V,J]=(0,a.useState)(null),[X,Z]=(0,a.useState)(null),ee=x.c.getUser(),te=new g.c,{api:ne}=(0,a.useContext)(o.U),{settings:{apiChatEnabled:re,aiAuthTokenProvided:ie}}=(0,c.k1)(),se=(0,a.useRef)(new AbortController),oe=(0,l.c)(),ce=e=>{switch(e){case"INVALID_SPECIFICATION":E(oe.formatMessage({id:"Apis.Details.ApiChat.components.specEnrichmentError.invalidSpecificationError",defaultMessage:"The OpenAPI specification could not be parsed. Ensure you are using a valid specification."}));break;case"INVALID_RESOURCE_PATH":E(oe.formatMessage({id:"Apis.Details.ApiChat.components.specEnrichmentError.invalidResourcePathError",defaultMessage:"The OpenAPI specification contain unsupported resource path definitions."}));break;case"UNSUPPORTED_MEDIA_TYPE":E(oe.formatMessage({id:"Apis.Details.ApiChat.components.specEnrichmentError.unsupportedMediaTypeError",defaultMessage:"The OpenAPI specification includes non-JSON input types which are not currently supported."}));break;case"UNSUPPORTED_SPECIFICATION":E(oe.formatMessage({id:"Apis.Details.ApiChat.components.specEnrichmentError.unsupportedSpecificationError",defaultMessage:"The OpenAPI specification includes components that are currently not supported."}));break;case"LLM":E(oe.formatMessage({id:"Apis.Details.ApiChat.components.specEnrichmentError.llmError",defaultMessage:"Failed to load API Chat."}));break;case"TOKEN_LIMIT_EXCEEDED":E(oe.formatMessage({id:"Apis.Details.ApiChat.components.specEnrichmentError.tokenLimitExceededError",defaultMessage:"The OpenAPI specification exceeds the maximum limit."}));break;case"STACK_OVERFLOW":E(oe.formatMessage({id:"Apis.Details.ApiChat.components.specEnrichmentError.stackOverflowError",defaultMessage:"The OpenAPI specification could not be parsed due to a cyclic reference or the excessive length of the specification."}));break;case"CONTENT_POLICY_VIOLATION":E(oe.formatMessage({id:"Apis.Details.ApiChat.components.specEnrichmentError.contentViolationError",defaultMessage:"The content in the OpenAPI specification violates the Azure OpenAI content policy."}));break;case"LLM_CONNECTION":E(oe.formatMessage({id:"Apis.Details.ApiChat.components.specEnrichmentError.llmConnectionError",defaultMessage:"There was an error connecting to Azure OpenAI."}));break;default:E(oe.formatMessage({id:"Apis.Details.ApiChat.components.specEnrichmentError.genericError",defaultMessage:"An error occurred when loading API Chat."}))}},le=e=>{switch(e){case"LLM":R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.llmError",defaultMessage:"An error occurred during query execution. Try again."}));break;case"CACHING":R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.cachingError",defaultMessage:"An error occurred during query execution. Try again later."}));break;case"RESPONSE_PARSING":R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.responseParsingError",defaultMessage:"An error occurred while attempting to extract the API response."}));break;case"API_COMMUNICATION":R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.apiCommunicationError",defaultMessage:"An error occurred while attempting to establish a connection with your API."}));break;case"TOKEN_LIMIT_EXCEEDED":R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.tokenLimitExceededError",defaultMessage:"Execution has been terminated due to exceeding the token limit."}));break;case"INVALID_COMMAND":R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.invalidCommandError",defaultMessage:"An invalid query is provided."}));break;case"CONTENT_POLICY_VIOLATION":R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.contentViolationError",defaultMessage:"Your query seems to contain inappropriate content. Please try again with a different query."}));break;case"LLM_CONNECTION":R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.llmConnectionError",defaultMessage:"There was an error connecting to Azure OpenAI."}));break;default:R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.genericError",defaultMessage:"An error occurred during query execution."}))}};(0,a.useEffect)((()=>{se.current.signal.aborted&&U(!0)}),[se.current.signal.aborted]),(0,a.useEffect)((()=>{z&&setTimeout((()=>{U(!1),s(!1)}),2e3)}),[z]);const de=()=>oe.formatMessage({id:"Apis.Details.ApiChat.components.onPremKeyInvalid.error",defaultMessage:"Provided token is invalid. Please use a valid token to start testing."}),pe=()=>oe.formatMessage({id:"Apis.Details.ApiChat.components.throttledOut.error",defaultMessage:"Your request has been throttled out. Please reach out to the administrator for assistance."}),me=()=>oe.formatMessage({id:"Apis.Details.ApiChat.components.gatewayTimeout.error",defaultMessage:"The request has timed out. Please try again later."});(0,a.useEffect)((()=>{if(ne&&ne.id&&re&&ie&&ee){C(!0),E(""),I("");const e=y.c.generateUUID();te.enrichOpenApiSpecification(ne.id,e).then((e=>{const{body:t,status:n}=e;201!==n?(C(!1),ce(t.code),I("warning")):(T(t.apiSpec),M(t.queries),C(!1))})).catch((e=>{var t;C(!1);const n=null==e||null===(t=e.response)||void 0===t?void 0:t.status;if(401===n)E(de()),I("error");else if(429===n)E(pe()),I("error");else if(504===n)E(me()),I("error");else{var a,r,i,s;ce((null==e||null===(a=e.response)||void 0===a||null===(r=a.body)||void 0===r?void 0:r.code)||"GENERIC"),I("WARN"===(null==e||null===(i=e.response)||void 0===i||null===(s=i.body)||void 0===s?void 0:s.level)?"warning":"error")}}))}}),[]);const ge=a.createElement(d.c,{id:"Apis.Details.ApiChat.warning.authTokenMissing",defaultMessage:"You must provide a token to start testing. To obtain one, follow the steps provided under {apiChatDocLink} ",values:{apiChatDocLink:a.createElement("a",{id:"api-chat-doc-link",href:"https://apim.docs.wso2.com/en/4.3.0/consume/invoke-apis/invoke-apis-using-tools/test-apis-with-apichat/",target:"_blank",rel:"noopener noreferrer"},"Test APIs with API Chat",a.createElement(p.c,{style:{marginLeft:"2px"},fontSize:"small"}))}}),he=a.createElement(d.c,{id:"Apis.Details.ApiChat.warning.apiAccessTokenNotFound",defaultMessage:"You must provide an API access token. Configure one by navigating to {configureKeyLink}",values:{configureKeyLink:a.createElement(u.cH,{onClick:()=>{t(!0)}},"Configure Key",a.createElement(p.c,{style:{marginLeft:"2px"},fontSize:"small"}))}}),fe=async(e,t)=>{const n=await(async e=>{const{method:t,path:n,inputs:a}=e,{parameters:r,requestBody:i}=a||{},s=[],o=Object.entries(r||{}).reduce(((e,t)=>{let[n,a]=t;return e.includes(`{${n}}`)?(s.push(n),e.replace(`{${n}}`,encodeURIComponent(a))):e}),n),c=Object.keys(r||{}).reduce(((e,t)=>(s.includes(t)||(e[t]=r[t]),e)),{}),l=new URLSearchParams(c).toString(),d=l?`${o}?${l}`:o,p=`${((e,t)=>{const n=e.find((e=>e.environmentName===t));return n?n.URLs:{}})(ne.endpointURLs,X).https}${d}`,u={"Content-Type":"application/json"};"OAUTH"===H?u.Authorization=`Bearer ${K}`:"BASIC"===H?u.Authorization=`Basic ${btoa(`${Y}:${V}`)}`:"API-KEY"===H&&(u.ApiKey=K);const m=ke({method:t,headers:u},"GET"!==t&&null!==i&&{body:JSON.stringify(i)});try{const e=await fetch(p,m),t=e.headers.get("Content-Type");if(t&&t.includes("application/json")){const t=await e.json().catch((()=>({})));return{code:e.status,path:d,headers:e.headers,body:t}}if(t&&t.includes("application/xml")){const t=await e.text();return{code:e.status,path:d,headers:e.headers,body:t}}const n=await e.text().catch((()=>"Unable to render this Content-Type"));return{code:e.status,path:d,headers:e.headers,body:n}}catch(e){return{code:500,path:d,headers:{},body:{description:"API invocation failed",error:e.message}}}})(t);L((e=>[...e,ke(ke({},n),{},{method:t.method})])),te.runAiAgentSubsequentIterations(ne.id,e,n).then((t=>{const{data:n}=t;if(201===t.status){if(se.current.signal.aborted)return;if(n.code)W(!0),le(n.code),s(!1);else{const{body:n}=t;switch(n.taskStatus){case"IN_PROGRESS":fe(e,n.resource);break;case"COMPLETED":n.result&&""!==n.result?R(n.result):R(oe.formatMessage({id:"Apis.Details.ApiChat.ApiChat.subsequentRequset.finalOutcome.taskCompleted",defaultMessage:"Task completed"})),s(!1);break;default:W(!0),R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.taskExecutionDefault",defaultMessage:"An error occurred during query execution."})),s(!1)}}}else{var a;W(!0),le(null==t||null===(a=t.data)||void 0===a?void 0:a.code),s(!1)}})).catch((e=>{var t;W(!0);const n=null==e||null===(t=e.response)||void 0===t?void 0:t.status;if(401===n)le(de());else if(429===n)le(pe());else if(504===n)le(me());else{var a;const t=(null==e||null===(a=e.response)||void 0===a?void 0:a.data)||"An error occurred during query execution.";le(t)}s(!1)}))},ye=e=>{if(W(!1),L((()=>[])),e.length<1)return void R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.noQuery",defaultMessage:"An invalid query is provided."}));s(!0),R("");const t=y.c.generateUUID();te.runAiAgentInitialIteration(ne.id,t,e,O).then((e=>{const{data:n}=e;if(201===e.status){if(se.current.signal.aborted)return;if(n.code)W(!0),le(n.code),s(!1);else{const{body:n}=e;switch(n.taskStatus){case"IN_PROGRESS":fe(t,n.resource);break;case"COMPLETED":n.result&&""!==n.result?R(n.result):R(oe.formatMessage({id:"Apis.Details.ApiChat.ApiChat.initialRequest.finalOutcome.taskCompletedOneItr",defaultMessage:"Task completed in 1 iteration."})),s(!1);break;default:W(!0),R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.taskExecutionDefault",defaultMessage:"An error occurred during query execution."})),s(!1)}}}else{var a;W(!0),le(null==e||null===(a=e.data)||void 0===a?void 0:a.code),s(!1)}})).catch((e=>{var t;W(!0);const n=null==e||null===(t=e.response)||void 0===t?void 0:t.status;if(401===n)le(de());else if(429===n)le(pe());else if(504===n)le(me());else{var a;const t=(null==e||null===(a=e.response)||void 0===a?void 0:a.data)||"An error occurred during query execution.";le(t)}s(!1)}))},xe=e=>{n||D(e),navigator.clipboard.writeText(e)},Ae=async e=>{n||(se.current=new AbortController,D(""),$(e),ye(e))};return a.createElement(Se,null,a.createElement(r.c,{className:Me},a.createElement(r.c,{sx:{flexGrow:1}},re&&ie&&a.createElement(ae,{isDrawerOpen:e,updateDrawerOpen:t,onConfigChange:e=>{let{newAccessToken:t,newSecurityScheme:n,newUsername:a,newPassword:r,newSelectedEnvironment:i}=e;void 0!==t&&_(t),void 0!==n&&G(n),void 0!==a&&F(a),void 0!==r&&J(r),void 0!==i&&Z(i)}}),a.createElement(j,{openConfigureKey:()=>{t(!0)},goBack:()=>{$(""),L([]),R("")},disableGoBack:n||""===P,disableConfigureKey:!re||!ie||b}),(n||P||B)&&a.createElement(Te,{lastQuery:P,executionResults:N,finalOutcome:B,isAgentRunning:n,isAgentTerminating:z,isExecutionErro:q}),!P&&a.createElement(k,null),!n&&!P&&!B&&w&&w.length>0&&a.createElement(r.c,{display:"flex",ml:3,mt:3},a.createElement(i.cp,{container:!0,direction:"row",spacing:3},w&&w.map((e=>{const t=2===w.length?6:4;return a.createElement(i.cp,{key:e.scenario,item:!0,xs:12,md:t},a.createElement(ue,{onExecuteClick:Ae,disabled:!(re&&ie&&H&&H&&(K||V)),queryData:e,onCopyClick:xe}))}))))),a.createElement(r.c,null,a.createElement(r.c,{display:"flex",alignItems:"center",flexDirection:"column",marginTop:1},A&&a.createElement(r.c,{display:"flex",justifyContent:"center"},a.createElement(h.c,{size:20}),a.createElement(f.c,{variant:"body1",sx:{paddingLeft:"5px"}},a.createElement(d.c,{id:"Apis.Details.ApiChat.ApiChat.loadingSpecEnrichmentMessage",defaultMessage:"We are in the process of preparing the API specification for API Chat."}))),b&&v&&a.createElement(m.c,{severity:v},a.createElement(f.c,{variant:"body1"},b)),!ie&&a.createElement(m.c,{severity:"warning"},a.createElement(f.c,{variant:"body1"},ge)),!ee&&a.createElement(m.c,{severity:"info"},a.createElement(f.c,{variant:"body1"},a.createElement(d.c,{id:"Apis.Details.ApiChat.warning.notSignedIn",defaultMessage:"You must sign in if you wish to interact with API Chat bot."})))),a.createElement(r.c,{display:"flex",alignItems:"center",flexDirection:"column",marginTop:1},(!H||!(H&&(K||V)))&&ie&&ee&&!b&&!A&&a.createElement(m.c,{severity:"warning"},a.createElement(f.c,{variant:"body1"},he))),a.createElement(r.c,{sx:{ml:7,mr:7}},a.createElement(Q,{isAgentRunning:n,isAgentTerminating:z,lastQuery:P,handleStopAndReExecute:()=>{n?(se.current.abort(),R(oe.formatMessage({id:"Apis.Details.ApiChat.components.finalOutcome.executionTerminated",defaultMessage:"Execution was terminated."})),L([]),s(!1)):(se.current=new AbortController,ye(P))},inputQuery:S,handleQueryChange:e=>{const{value:t}=e.target;D(t)},isEnrichingSpec:A,specEnrichmentError:b,handleExecute:async()=>{if(0!==S.length){se.current=new AbortController;const e=S;D(""),$(S),ye(e)}},isExecuteDisabled:!(re&&ie&&H&&H&&(K||V))})))))}}}]);
//# sourceMappingURL=ApiChat.bb1eb22a59a0eebcc9e2.bundle.js.map